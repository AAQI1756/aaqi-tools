// A comprehensive list of all your tools
const allTools = [
    { id: 'stocks', name: 'Stocks', icon: 'fas fa-chart-line', url: '/stocks.html' },
    { id: 'image-compressor', name: 'Image Compressor', icon: 'fas fa-image', url: '/image-compressor.html' },
    { id: 'image-converter', name: 'Image Converter', icon: 'fas fa-exchange-alt', url: '/image-converter.html' },
    { id: 'loan', name: 'Loan Calculator', icon: 'fas fa-hand-holding-usd', url: '/loan-calculator.html' },
    { id: 'income-tax', name: 'Income Tax', icon: 'fas fa-calculator', url: '/Tax-fbr.html' },
    // ... add all other tools here
];

const popularDefaults = ['stocks', 'image-compressor', 'image-converter', 'loan', 'income-tax'];
const recentToolsContainer = document.querySelector('.recent-tools .tool-list');
const popularToolsContainer = document.querySelector('.popular-tools .tool-grid');

// Function to render recent apps from localStorage
function renderRecentApps() {
    const recentApps = JSON.parse(localStorage.getItem('recentApps') || '[]');
    recentToolsContainer.innerHTML = ''; // Clear previous content

    recentApps.slice(0, 3).forEach(toolId => { // Limit to 3 apps for the recent section
        const tool = allTools.find(t => t.id === toolId);
        if (tool) {
            const toolHtml = `<a href="${tool.url}" class="tool-icon" data-tool="${tool.id}">
                                  <i class="${tool.icon}"></i>
                                  <span>${tool.name.split(' ')[0]}</span>
                              </a>`;
            recentToolsContainer.innerHTML += toolHtml;
        }
    });
}

// Function to render popular apps, using defaults
function renderPopularApps() {
    popularToolsContainer.innerHTML = ''; // Clear previous content

    const popularAppsToDisplay = popularDefaults; // For now, just show defaults
    
    // In a real-world scenario, you'd merge user-interest data here.
    // E.g., const userInterestApps = getUserInterestApps();
    // const popularAppsToDisplay = [...new Set([...popularDefaults, ...userInterestApps])].slice(0, 8);
    
    popularAppsToDisplay.forEach(toolId => {
        const tool = allTools.find(t => t.id === toolId);
        if (tool) {
            const toolHtml = `<a href="${tool.url}" class="tool-card" data-tool="${tool.id}">
                                  <i class="${tool.icon}"></i>
                                  <h3>${tool.name}</h3>
                              </a>`;
            popularToolsContainer.innerHTML += toolHtml;
        }
    });
}

// Function to handle a tool click
function handleToolClick(event) {
    const toolLink = event.target.closest('.tool-card, .tool-icon');
    if (toolLink) {
        const toolId = toolLink.dataset.tool;
        let recentApps = JSON.parse(localStorage.getItem('recentApps') || '[]');
        
        // Remove the tool from the list if it already exists
        recentApps = recentApps.filter(id => id !== toolId);
        
        // Add the tool to the beginning of the list
        recentApps.unshift(toolId);
        
        // Save the updated list to localStorage
        localStorage.setItem('recentApps', JSON.stringify(recentApps));
        
        // Re-render the recent apps section
        renderRecentApps();
    }
}

// Initial rendering on page load
document.addEventListener('DOMContentLoaded', () => {
    renderRecentApps();
    renderPopularApps();
    
    // Add event listeners to all tool links
    document.body.addEventListener('click', handleToolClick);
});
